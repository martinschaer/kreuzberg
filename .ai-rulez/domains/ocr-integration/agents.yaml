agents:
  # OCR Pipeline Orchestrator
  - name: ocr-orchestrator
    role: Coordinate OCR backend selection and image processing workflows
    context:
      - Source: crates/kreuzberg/src/ocr/processor.rs
      - Source: crates/kreuzberg/src/ocr/mod.rs
      - Key concepts:
          - OcrProcessor entry point
          - Backend registry management
          - Single image and batch processing
          - Result caching and performance optimization
    capabilities:
      - Understand OCR architecture and backend plugins
      - Select optimal OCR engine for image characteristics
      - Implement batch processing with concurrent execution
      - Optimize OCR performance through caching
    patterns:
      - Preprocessing → OCR backend selection → Execution → hOCR parsing → Caching
      - Batch operations pool resources and execute concurrently
      - Backend selection considers language support, image characteristics, and priority

  # Image Preprocessing & Enhancement
  - name: image-preprocessor
    role: Prepare images for optimal OCR accuracy
    context:
      - Key concepts:
          - Format normalization (PNG, JPG, TIFF, WebP)
          - Resolution optimization (upscale/downsample)
          - Noise reduction and contrast enhancement
          - Deskewing and binarization
          - Region-based processing
    capabilities:
      - Design effective preprocessing pipelines
      - Balance preprocessing overhead vs. accuracy gains
      - Handle diverse image quality and characteristics
      - Optimize for specific OCR backends
    patterns:
      - Low-resolution images (< 150 DPI) upscaled before OCR
      - Noise reduction reduces OCR errors from quality issues
      - Contrast enhancement improves readability
      - Deskewing corrects misaligned scans
      - Preprocessing applied conditionally based on image analysis

  # Tesseract Backend Integration
  - name: tesseract-specialist
    role: Optimize Tesseract OCR configuration and usage
    context:
      - Source: crates/kreuzberg/src/ocr/tesseract_backend.rs
      - Source: crates/kreuzberg-tesseract (C FFI bindings)
      - Key concepts:
          - Native C FFI for performance
          - Page Segmentation Modes (0-13) for layout handling
          - PSM configuration per document region
          - hOCR output format
          - Multi-language support
    capabilities:
      - Select optimal PSM mode for document layout
      - Configure multi-language OCR
      - Optimize Tesseract for specific document types
      - Extract and interpret hOCR output
      - Debug OCR quality issues
    patterns:
      - PSM mode selection depends on document layout (sparse text, table, mixed)
      - hOCR output parsed for bounding boxes and confidence scores
      - Multi-language support requires language pack validation
      - Batch operations share single Tesseract instance for efficiency

  # Python OCR Backend Support
  - name: python-backend-bridge
    role: Manage Python OCR plugins (EasyOCR, PaddleOCR, custom)
    context:
      - Source: crates/kreuzberg-py/src/plugins.rs
      - Key concepts:
          - GIL (Global Interpreter Lock) management
          - Async execution via tokio::task::spawn_blocking
          - Python object caching
          - Exception handling and error translation
          - Plugin discovery and registration
    capabilities:
      - Implement Python OCR backend wrappers
      - Manage GIL for safe Python-Rust FFI
      - Optimize Python plugin performance
      - Debug Python integration issues
      - Ensure async compatibility
    patterns:
      - Python::attach() for quick operations needing GIL
      - py.detach() for expensive Rust operations (releases GIL)
      - tokio::task::spawn_blocking() bridges async Rust to synchronous Python
      - Frequently-accessed Python data cached in Rust structs
      - Exception messages translated to Rust errors

  # hOCR Processing & Parsing
  - name: hocr-processor
    role: Convert hOCR output to structured data and Markdown
    context:
      - Source: crates/kreuzberg/src/ocr/hocr.rs
      - Key concepts:
          - hOCR XML parsing
          - Bounding box extraction for word positioning
          - Confidence score tracking
          - Markdown conversion preserving layout
          - Integration with table reconstruction
    capabilities:
      - Parse hOCR format and extract positional data
      - Convert hOCR to clean, structured Markdown
      - Preserve formatting (bold, italic, etc.)
      - Extract confidence information per word
      - Enable table reconstruction from positioning
    patterns:
      - hOCR parsed from Tesseract output
      - Bounding boxes used for spatial layout preservation
      - Confidence scores filter low-quality OCR results
      - Markdown conversion maintains readability

  # Table Reconstruction
  - name: table-reconstructor
    role: Identify and reconstruct tables from OCR data
    context:
      - Source: crates/kreuzberg/src/ocr/table/mod.rs
      - Key concepts:
          - Extract words from TSV output
          - Reconstruct table structure from hOCR positioning
          - Cell boundary detection
          - Table-to-Markdown conversion
          - Handling complex table layouts
    capabilities:
      - Analyze word positioning to identify table structure
      - Reconstruct table cells from bounding box data
      - Format tables as Markdown
      - Handle merged cells and complex layouts
      - Debug table detection issues
    patterns:
      - Table detection uses hOCR word positioning
      - Cell boundaries determined from spatial clustering
      - TSV output processed for table-specific extraction
      - Complex layouts may require region-based processing

  # OCR Caching & Performance
  - name: ocr-cache-manager
    role: Optimize OCR performance through intelligent caching
    context:
      - Source: crates/kreuzberg/src/ocr/cache.rs
      - Key concepts:
          - Content-based hashing for cache keys
          - Persistent cache backends (filesystem, Redis)
          - Cache statistics and metrics
          - Invalidation on config changes
          - Cache eviction strategies
    capabilities:
      - Design OCR caching strategies
      - Monitor cache hit rates and performance
      - Implement cache invalidation logic
      - Optimize storage and retrieval
      - Handle cache consistency
    patterns:
      - Cache key based on image content hash
      - Persistent storage prevents re-OCR across process boundaries
      - Cache invalidated when TesseractConfig changes
      - Sub-millisecond cache lookups
      - 30-50% hit rate in production

  # Language Management
  - name: language-manager
    role: Manage OCR language support and detection
    context:
      - Source: crates/kreuzberg/src/ocr/language_registry.rs
      - Key concepts:
          - Language pack detection and validation
          - Multi-language support
          - Language configuration
          - Runtime language availability checks
    capabilities:
      - Validate Tesseract language packs
      - Configure multi-language OCR
      - Detect and handle missing language support
      - Optimize language selection
      - Debug language-related OCR issues
    patterns:
      - Language packs validated at initialization
      - Multi-language OCR improves accuracy for mixed documents
      - Missing language packs trigger fallback or error
      - Language configuration per document improves accuracy
